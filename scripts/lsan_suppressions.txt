# SPDX-License-Identifier: GPL-2.0-or-later

# This is a set of suppressions for LeakSanitizer; you can use it by setting
#   LSAN_OPTIONS="suppressions=/path/to/scripts/lsan_suppressions.txt"
# when running a QEMU built with the leak-sanitizer.

# The tcmalloc on Fedora37 confuses things
leak:/lib64/libtcmalloc_minimal.so.4

# libxkbcommon also leaks in qemu-keymap
leak:/lib64/libxkbcommon.so.0

# g_set_user_dirs() deliberately leaks the previous cached g_get_user_*
# values. This is documented in upstream glib's valgrind-format
# suppression file:
# https://github.com/GNOME/glib/blob/main/tools/glib.supp
# This avoids false positive leak reports for the qga-ssh-test.
leak:g_set_user_dirs

# The walk_path() function in qos-test does free its memory,
# but something about the setup with tests run in a subprocess
# seems to confuse the sanitizer. Suppress the errors.
leak:walk_path

# qemu_irq_intercept_in is only used by the qtest harness, and
# its API inherently involves a leak.
# While we could keep track of the old IRQ data structure
# in order to free it, it doesn't seem very important to fix
# since it is only used by the qtest test harness.
# Just ignore the leak, at least for the moment.
leak:qemu_irq_intercept_in
